## 《FFmpeg入门详解-音视频原理及应用》

chap1、

### chap2、音视频入门

#### 2.1、音视频入门引言

##### 2.1.4 自学音视频的困惑

+ 知识分散、过渡断层，**如何构建相关知识树？**

#### 2.2 音视频基础概念

##### 2.2.1、视频

+ 1、动画书
  + **视频本质是由一系列图片构成的**
+ 2、视频
+ 3、视频帧
  + **Frame，一幅画面**，一段视频是由许多帧组成的
+ 4、帧率
  + 帧率**单位时间内帧的数量**，单位f/s
  + 24-25f/s，一秒24或2帧，电视/电影的帧率
  + 游戏中30可以接受，60会感到十分流畅，85f/s以上人眼看不出画面过渡了
+ 5.色彩空间
  + RGB
  + YUV
    + (1)Y：亮度，即灰度值。除了表示亮度信号外，还含有较多的绿
      色通道量。
    + (2)U：蓝色通道与亮度的差值。
    + (3)V：红色通道与亮度的差值
+ 6.YUV的优势
+ 7.RGB和YUV的换算

##### 2.2.2 音频

+ 1、基本知识
  + 音频数据的承载方式最常用的是脉冲编码调制，即PCM
  + 声音是一种波，有振幅和频率，所以要保存声音，就要保存声音
    在各个时间点上的振幅，但数字信号并不能连续保存所有时间点的振
    幅，事实上，并不需要保存连续的信号也可以还原出人耳可接受的声
    音。
  + PCM的采集分为以下步骤：
    + 模拟信号→采样→量化→编码→数字信号
+ 2.采样率和采样位数
  + 采样率，即采样的频率。上面提到，采样率要大于原声波最高频
    率的2倍，人耳能听到的最高频率约为20kHz，所以为了满足人耳的
    听觉要求，采样率至少应为40kHz，通常为44.1kHz，更高的频率通
    常为48kHz。
    注意：人耳听觉频率范围为[20Hz，20kHz]。
+ 3.音频编码
  + 音频编码是指要在计算机内播放或者处理音频文件，也就是要对
    声音文件进行数、模转换，这个过程同样由采样和量化构成
+ 4.声道数
  + 声道数是指所支持的能发不同声音的音响的个数，常见的声道数
    如下。
    + (1)单声道：1个声道。
    + (2)双声道：两个声道
    + (3)立体声道：默认为两个声道。
    + (4)立体声道（4声道）：4个声道
+ 5.码率
  + 码率指**一个数据流中每秒能通过的信息量**，单位为b/s，公式是**采样率`*`采样位数`*`声道数**
+ 6.音频格式

##### 2.2.3 音视频编码

+ 指的是**压缩编码**
  + 未经压缩的大概有多大，*怎么计算，lionel*
+ 1.视频编码
  + 通常为**有损压缩**
  + H.26x系列，ITU主导
  + MPEG系列，ISO下属
  + 其它系列
+ 2.音频编码
  + AAC压缩格式。AAC格式主要分为两种：音频数据交换格式(Audio Data Interchange Format，
    ADIF)和音频数据传输流(Audio Data Transport Stream，ADTS)
    + ADIF
    + ADTS
+ 3.硬解码和软解码
  + 软解码是指利用CPU的计算能力来解码，通常如果CPU的能力不是很强，解码速度则会比较慢，也可能出现发热现象
  + 硬解码指的是利用专门的解码芯片来加速解码，通常硬解码的解码速度会快很多，但是由于硬解码由各个厂家实现

##### 2.2.4 音视频容器

+ MP4、RMVB、AVI、MKV、MOV等。这些常见的视频格式，其实是包裹了音视频编码数据的容器，用来把特定编码标准编码的视频流和音频流混在一起，成为一个文件。

#### 2.3 多媒体基础概念

#### 2.4 数字电视基础概念

#### 2.5 短视频基础概念

### chap3、音视频开发常用工具

#### 3.1 VLC播放器简介

#### 3.2 MediaInfo简介

+ 分析视频和音频文件的编码和内容信息

#### 3.3 FlvAnalyser简介

#### 3.4 Elecard Stream Analyzer码流分析工具

##### 3.4.1 简介

+ 码流是指**视频文件在单位时间内使用的数据流量**，是视频编码中画面质量控制中最重要的部分。（码流越大，压缩比越小，画面质量越好）

#### 3.5 FFmpeg简介

### 第4章 音频基础

#### 4.1 音频基础概念

##### 4.1.1 声音和音频

+ 1.声音的三要素
  + 声音的三要素为**频率、振幅和波形**。
  + 频率是指声波的频率，即声
    音的音调，人类听觉的频率（音调）范围为[20Hz，20kHz]。振幅是
    指声波的响度，通俗地讲就是声音的高低，可以理解为音量，例如一
    般男生的声音振幅（响度）大于女生。波形是指声音的音色，在同样
    的频率和振幅下，钢琴和小提琴的声音听起来是完全不同的，因为它
    们的音色不同。波形决定了其所代表声音的音色，音色不同是因为它
    们的介质所产生的波形不同。综上所述，声音的本质就是音调、音量
    和音色。音调是指频率，音量是指振幅，音色与材质有关。
+ 2.音频的基础概念

##### 4.1.2 数字音频

+ 1.采样
+ 2、量化
+ 3、编码

+ 4.其他概念

##### 4.1.3 音频采集

+ 1.直接获取已有音频数据

+ 2.利用音频处理软件捕获截取
+ 3.利用话筒录制

##### 4.1.4 音频处理

+ 1.噪声抑制
+ 2.回声消除
+ 3.自动增益控制
+ 4.静音检测
+ 5.舒适噪声产生

##### 4.1.5 音频使用场景及应用

##### 4.1.6 音频格式

+ 11.FLAC

##### 4.1.7 混音技术

+ 混音就是把两路或者多路音频流混合在一起，形成一路音频流。
  混流则是指音视频流的混合，也就是视频画面和声音的对齐。

##### 4.1.8 音频重采样

#### 4.2 音频编码原理

##### 4.2.2 音频编码

+ 1.音频编码概述
  + 

##### 4.2.3 音频编码基本手段

+ 音频编码的基本手段包括量化器和语音编码器。
+ 1.量化和量化器
+ 2.语音编码器（3种类型）
  + 波形编码器
  + 声码器
  + 混合编码器

##### 4.2.4 音频编码算法

+ 常见的音频编码算法有OPUS、AAC、Vorbis、Speex、iLBC、AMR、G.711等。

#### 4.3 音频深度学习

##### 4.3.2 十大音频处理任务

+ (10)音符起始点检测是分析音频／建立音乐序列的第一步，对于
  以上提到的大多数任务而言，执行音符起始点检测是必要的

### 第5章 视频基础

#### 5.1 视频基础概念

##### 5.1.1 图像与像素

+ 1
+ 2
+ 3
+ 4、像素位深度

##### 5.1.2 色彩空间

#### 5.2 音视频封装

#### 5.3、视频压缩编码

##### 5.3.1 视频编码基础知识

+ 1.视频和图像的关系

##### 5.3.2 视频压缩

##### 5.3.3 视频编码原理

##### 5.3.4 视频编码的关键技术

+ 编码器(Encoder)是指压缩信号
  的设备或程序；解码器(Decoder)是指解压缩信号的设备或程序；编
  解码器(Codec)是指编解码器对。编码的主要流程包括预测、变换、
  量化、熵编码，解码的流程与之互逆
+ 第一，为什么要变换？
+ 第二，为什么要量化？
+ 第三，为什么要采用熵编码？

##### 5.3.5 视频编解码流程

+ 编码过程包括运动估计、运动补偿、DCT、量化与熵编码等
+ 解码是编码的逆操作

#### 5.4 视频播放原理

##### 5.4.1 视频播放器简介

##### 5.4.2 FFmpeg播放架构与原理

### chap6、音视频压缩编码基础

#### 6.1、音视频压缩编码

+ 空间冗余
+ 时间冗余
+ 视觉冗余
+ 信息熵
+ 结构冗余
+ 知识冗余

#### 6.2、压缩编码技术分类

+ **数据=信息+数据冗余**
+ **无损压缩**也称为可逆编码，重构后的数据与原数据完全相同，适用于磁盘文件的压缩等。
+ **有损压缩**也称为不可逆编码，指使用压缩后的数据进行重构（解压缩）时，重构后的数据与原来的数据有差异，但不会使人们对原始资料所表达的信息造成误解。

##### 6.2.1、无损压缩

+ 1、哈夫曼编码
+ 2、香农编码
+ 3、算术编码

##### 6.2.2、有损压缩

+ 典型的有损压缩编码技术包括以下几项
  + 1、预测编码主要是减少数据在空间和时间上的相关性，以达到对数据压缩的目的
  + 2、变换编码将图像时域信号变换到频域上进行处理
  + 3、量化编码包括标量量化、矢量量化，当对模拟信号进行数字化时，需要经历一个量化的过程。
  + 4、子带编码包括子带编码、块切割法，子带编码主要有两种方式。
  + 5、模型编码包括结构模型、知识基模型。结构模型编码也称为二代编码
  + 6、混合编码包括JPEG、H.261、MPEG等，同时使用两种或两种以上的编码方法进行编码。

#### 6.3 压缩编码关键技术

+ 预测是指通过帧内预测和帧间预测降低视频图像的空间冗余和时间冗余。
+ 变换是指通过从时域到频域的变换，去除相邻数据之间的相关性，即去除空间冗余。
+ 量化是指通过用更粗糙的数据表示精细的数据来降低编码的数据量，或者通过去除人眼不敏感的信息来降低编码数据量。
+ 熵编码是根据待编码数据的概率特性减少编码冗余。从信号处理层面入手，以像素、块为表示基础的视频图像包含大量冗余信息，如时间冗余、空间冗余和感知冗余等。

##### 6.3.1、预测编码

+ 预测编码主要包括空间预测编码和时间预测编码。
  + 空间预测是利用图像空间相邻像素的相关性来预测的方法。
  + 时间预测是利用时间上相邻图像的相关性来预测的方法。
+ 预测编码的基本原理是计算出信号的预测值，然后与实际值求差。

##### 6.3.2、变换

+ 变换编码是从频域的角度减小图像信号的空间相关性，它在降低数码率等方面取得了和预测编码相近的效果。

##### 6.3.3、量化

+ 量化就是把经过抽样得到的瞬时值将其幅度离散，即用一组规定的电平，把瞬时抽样值用最接近的电平值来表示，或指把输入信号幅度连续变化的范围分为有限个不重叠的子区间（量化级），每个子区间用该区间内一个确定数值表示，落入其内的输入信号将以该值输出，从而将连续输入信号变为具有有限个离散值电平的近似信号。

##### 6.3.4、熵编码

+ 熵编码即编码过程中按熵原理不丢失任何信息的编码。信息熵为信源的平均信息量（不确定性的度量）。

#### 6.4 帧内编码与帧间编码

##### 6.4.1、帧内编码

+ 帧内预测技术，即利用当前编码块周围已经重构出来的像素预测当前块。帧内编码是空间域编码，利用图像空间性冗余度进行图像压缩，处理的是一幅独立的图像，不会跨越多幅图像。

6.4.2 帧间编码

6.4.3 运动矢量

6.4.4 运动补偿

##### 6.4.5、双向预测

#### 6.5、GOP与DTS/PTS

##### 6.5.1、I/P/B/IDR帧

##### 6.5.2、GOP详细讲解

##### 6.5.3、DTS和PTS详细讲解

### 第7章 音视频编解码原理与标准

### chap08、音视频编解码技术与流程

+ 技术主要包括I帧、P帧和B帧技术、运动估计和运动补偿等
+ 视频压缩编码过程一般分为3个步骤，包括时间维压缩、空间维压缩及熵编码。

#### 8.1 视频编码简介

#### 8.2 视频编码流程

+ 视频编码最主要的工作就是压缩，分为帧内压缩和帧间压缩，然后又分为几个步骤，主要包括预测、变换、量化、熵编码、滤波处理等，但压缩是分步骤的，不是简单地把图像中重复的数据直接聚合在一起。依据方法论，可压缩的内容有两种：单幅图像的压缩和多幅图像的压缩。
+ **帧内压缩**，一张图像，分成若干小块，每块为8×8像素大小，如果这个小块的每像素的颜色都是白色，就可以用一个点的值来代替这所有64个点的值，在编码中该标准术语叫空间冗余，相应的方法叫帧内压缩
+ **帧间压缩**，视频中一个连续的动作，例如画面里的男主角在蓝墙背景下闭上了眼睛，这一动作的背后，是由一系列的多幅图片组成的，而每幅图片的内容基本上都是一样的，唯一变化的部分就是眼睛所在图像区域，眼睛缓慢由开到闭，这块区域的像素值发生了变化。对于绝大多数的背景区域，它是没有变化的，那么除了含有闭眼动作的这块区域，是否可以只用一张图像来代替这么多个连续的图像呢？这在编码中的术语叫时间冗余，强调的是**在一定时间段内如何对连续多幅图像的冗余部分进行压缩**，其专业术语叫帧间压缩
+ 图像的空间冗余和时间冗余都被压缩了，压缩成一串字符串，然后还可以对这段字符串进行进一步压缩，就是所谓的**编码冗余**。

#### 8.3 I/P/B帧技术详细讲解

##### 8.3.1 I/P/B帧编解码技术

+ I帧是自带全部信息的独立帧，是最完整的画面，占用的空间最大，不需要参考其他图像便可独立进行解码。视频序列中的第1个帧，始终都是I帧。
+ P帧即帧间预测编码帧，需要参考前面的I帧和（或）P帧的不同部分，这样才能进行编码。P帧对前面的P和I参考帧有依赖性，但P帧压缩率比较高，占用的空间较小。
+ B帧即双向预测编码帧，以前帧和后帧作为参考帧。不仅参考前面，还参考后面的帧，所以它的压缩率最高，可以达到200:1。**不适合实时传输，例如视频会议**

##### 8.3.2 I/P/B帧的特点

+ I帧的特点
  + (1)I帧是一个全帧压缩编码帧，它将全帧图像信息进行JPEG压缩
    编码及传输。
  + (9)训练视频分类任务的时候往往在处理I帧的时候要采用更加复
    杂的网络。
+ 2.P帧的特点
  + (7)由于采用的是差值传送，所以P帧的压缩比较高。
+ 3.B帧的特点
  + (5)B帧不是参考帧，不会造成解码错误的扩散。

##### 8.3.3 I/P/B帧的基本流程

+ 1.I帧编码的基本流程
+ 2.P帧和B帧编码的基本流程

##### 8.3.4 帧内与帧间编码

+ 对I帧的处理是采用帧内编码的方式，只利用本帧图像内的空间相
  关性。对P帧的处理，采用帧间编码，如前向运动估计，同时利用空
  间和时间上的相关性。简单来讲，采用运动补偿算法来去掉冗余信
  息。I帧和P帧的编码如图8-16所示。对B帧采取双向预测内插编码的
  压缩算法。

##### 8.3.5 帧内编码流程

+ 图8-17 帧内编码的流程图
+ 帧内编码需要经过DCT、量化、编码等多个过程，涉及的技术包
  括RGB转YUV、图片宏块切割、DCT离散余弦变换、量化、Zig-Zag
  扫描、DPCM差值脉冲编码调制、RLE游程编码、哈夫曼编码、算数
  编码等。

##### 8.3.6 块与宏块

+ 一般是把
  图像切割为不同的块或宏块，然后对它们进行计算。一个宏块一般为
  16×16像素。宏块是编码处理的基本单元，通常宏块大小为16×16像
  素。一个编码图像首先要划分成多个块（4×4像素）才能进行处理，
  所以宏块应该由整数个块组成。宏块分为I、P、B宏块，I宏块（帧内
  预测宏块）只能利用当前片中已解码的像素作为参考进行帧内预测；
  P宏块（帧间预测宏块）可以利用前面已解码的图像作为参考图像进
  行帧内预测；B宏块（帧间双向预测宏块）则是利用前后向的参考图
  像进行帧内预测。可以将一张图片切割为多个宏块

#### 8.4 运动估计和运动补偿

+ 运动估计的基本思想是将图像序列的每帧分成许多互不重叠的宏
  块，并认为宏块内所有像素的位移量都相同，然后对每个宏块到参考
  帧某一给定搜索范围内根据一定的匹配准则找出与当前块最相似的
  块，即匹配块，匹配块与当前块的相对位移即为运动矢量。视频压缩
  的时候，只需保存运动矢量和残差数据就可以完全恢复出当前块。
+ 运
  动补偿是一种描述相邻帧（相邻在这里表示在编码关系上相邻，在播
  放顺序上两帧未必相邻）差别的方法，具体来讲是描述前面一帧的每
  个小块怎样移动到当前帧中的某个位置去。这种方法经常被视频压缩
  ／视频编解码器用来减少视频序列中的空域冗余。它也可以用于去交
  织及运动插值的操作。

#### 8.5 音频编码技术与流程

##### 8.5.1 MPEG-1音频编码

##### 8.5.2 MPEG-2音频编码

##### 8.5.3 MPEG-4音频编码

##### 8.5.4 AC-3音频编码

### chap9、H.264编解码基础

### chap10、AAC编解码基础

### chap11、H.265编解码基础