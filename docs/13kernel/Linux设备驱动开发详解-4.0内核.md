## 《Linux设备驱动开发详解：基于4.0内核》

### chap3、Linux内核及内核编程

#### 3.3、Linux内核的组成

##### 3.3.1、Linux内核源代码的目录结构

##### 3.3.2、Linux内核的组成部分

+ 5个部分（**图3.3**里的各组成部分的关系）
  + VFS
  + MM
  + SCHED
  + NET
  + IPC
+ 5个部分的依赖关系是：

###### 1、进程调度

+ 多个进程对CPU的访问
+ *Linux进程状态转换*
+ `struct task_struct{};`
  + pthread_create()的时候，本质上内核只是创建了一个新的task_struct。

###### 2、内存管理

+ **多个进程安全地共享主存区域**
+ 内核空间和用户空间的具体界限是可以调整的

###### 5、进程间通信

+ 支持进程间的多种通信机制，包括**信号量、共享内存、消息队列、管道、UNIX域套接字**

+ Android内核新增了**Binder进程间通信**

##### 3.3.3、Linux内核空间与用户空间

+ ARM处理器的7种工作模式

#### 3.4、Linux内核的编译及加载

##### 3.4.1、Linux内核的编译

3.5、Linux下的C编程特点

3.6、工具链

3.7、实验室建设

3.8、串口工具

3.9、总结

### chap4、Linux内核模块

+ *lionel，这个地方，自己可以写个sample，还是必须要靠环境*

#### 4.1、Linux内核模块简介

+ **模块**本身不被编译入内核映像，一旦被加载，它就和内核中的其他部分完全一样
+ `modinfo hello.ko`

#### 4.2、Linux内核模块程序结构

#### 4.3、模块加载函数

+ 以`__init`标识声明，加载函数

#### 4.4、模块卸载函数

+ 以`__exit`

4.5、模块参数

4.6、导出符号

4.7、模块声明与描述

4.8、模块的使用计数

4.9、模块的编译

4.10、使用模块“绕开”GPL

4.11、总结

### chap5、Linux文件系统与设备文件

#### 5.1、Linux文件操作

#### 5.2、Linux文件系统

##### 5.2.1、Linux文件系统目录结构

##### 5.2.2、Linux文件系统与设备驱动

+ *lionel，这个命令的执行，我好像在哪看过，但不记得了，应该也是 宋宝华，还是 Linux C一站式里的了*

+ VFS与文件系统以及设备文件之间的接口**是`file_operations`结构体成员函数**
+ fs/block.c中的`def_blk_fops`
+ `dd if=/dev/sdb1 of=sdb1.img`

###### 1、file结构体，`struct file{};`

###### 2、inode结构体，`struct inode{};`

#### 5.3、devfs（2.4引入，2.6抛弃了）

+ **设备文件系统**，2.4引入，有如下优点
  + 1、可通过程序在设备初始化时在/dev目录下创建设备文件，卸载设备时将它删除
  + 2、
  + 3、

#### 5.4、udev用户空间设备管理

##### 5.4.1、udev与devfs的区别

5.4.2、sysfs文件系统与Linux设备模型

5.4.3、udev的组成

5.4.4、udev规则文件

#### 5.5、总结

### chap12、Linux设备驱动的软件架构思想

#### 12.1、Linux驱动的软件架构

+ 对于网卡驱动，Linux的想法是，**这个网卡驱动应该最好一行都不要改就可以在任何一个平台上跑起来**
+ Linux字符设备驱动需要**编写`file_operations`成员函数，负责处理阻塞、非组塞、多路复用、SIGIO等复杂事物**
+ **提炼出一个input核心层**

#### 12.2、platform设备驱动

##### 12.2.1、platform总线、设备与驱动

#### 12.3、设备驱动的分层思想

#### 12.4、主机驱动与外设驱动分离的设计思想

#### 12.5、总结

### chap14、Linux网络设备驱动

#### 14.1、Linux网络设备驱动的结构

+ 4层
  + 网络协议接口层，**数据包，接收，发送**，dev_queue_xmit()、netif_rx()
  + 网络设备接口层，**数据结构net_device**
  + 设备驱动功能层，**数据包发送、中断处理（接收）**，hard_start_xmit()、
  + 网络设备与媒介层，**网络物理设备**

##### 14.1.1、网络协议接口层

##### 14.1.2、网络设备接口层

##### 14.1.3、设备驱动功能层

