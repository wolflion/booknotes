### 《卷1协议》

+ 某乎上网友（17-20）是重点
+ TCP（17-24）

### chap17、TCP

#### 17.1、引言

#### 17.2、TCP的服务

+ TCP通过下列方式来提供可靠性
  + 应用数据被分割成TCP认为最适合发送的数据块
  + TCP发送一个段后，**启用定时器**，等待目的端确认收到这个报文段
  + 收到后会发送确认，**但不是立即发送，而是推迟几分之一秒**
  + 将保持它首部和数据的检验和
  + 数据报会失序，**如果必要，收到后会重排**
  + TCP接收端必须丢弃重复的数据
  + 流量控制
+ *字节流服务，没太懂，上面的都懂了*

#### 17.3、TCP的首部

+ *感觉也没必要背这个字段*
+ https://lxr.missinglinkelectronics.com/linux+v5.0/include/uapi/linux/tcp.h#L25 中定义了`struct tcphdr{}`

```c
struct tcphdr {  
	__u16	source;  //16位源端口号
	__u16	dest;    //16位目的端口号
	__u32	seq;     // 32位序号
	__u32	ack_seq; // 32位确认序号
	//4位首部长度
    //6位保留
    //urg,ack,psh,rst,syn,fin 各占1位
	__u16	window;   //16位窗口大小
	__u16	check;    //16位检验和
	__u16	urg_ptr;  //16位紧急指针
    //选项
    //数据
};
```



#### 17.4、小结

+ Telnet、Rlogin、FTP和SMTP都使用TCP.

#### 习题

+ 17.4、为什么在TCP首部的开始便是源和目的端口号?

### chap18、TCP连接的建立与终止

#### 18.1、引言

#### 18.2、连接的建立与终止

+ `telnet bsdi discard`，*暂时我还不知道是啥意思*

##### 18.2.1、tcpdump的输出

18.2.2、时间系列

18.2.3、建立连接协议

18.2.4、连接终止协议

18.2.5、正常的tcpdump输出

#### 18.3、连接建立的超时

##### 18.3.1、第一次超时时间

##### 18.3.2、服务类型字段

#### 18.4、最大报文段长度

+ **MSS选项只能出现在SYN报文段中**

#### 18.5、TCP的半关闭

#### 18.6、TCP的状态变迁图

+ 183/424的**图18-12**，自己记一下

##### 18.6.1、2MSL等待状态

##### 18.6.2、平静时间的概念

##### 18.6.3、FIN_WAIT_2状态

#### 18.7、复位报文段

##### 18.7.1、找不存在的端口的连接请求

##### 18.7.2、异常终止一个连接

##### 18.7.3、检测半打开连接

#### 18.8、同时打开

#### 18.9、同时关闭

#### 18.10、TCP选项

#### 18.11、TCP服务器的设计

##### 18.11.1、TCP服务器端口号

##### 18.11.2、限定的本地IP地址

##### 18.11.3、限定的远端IP地址

##### 18.11.4、呼入连接请求队列

#### 18.12、小结

+ **弄清TCP操作的关键在于它的状态变迁图**

#### 习题

+ 18.3、半打开连接和半关闭连接的区别是什么？

### chap19、TCP的交互数据流

### chap20、TCP的成块数据流