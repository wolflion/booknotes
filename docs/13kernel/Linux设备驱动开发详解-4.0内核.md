## 《Linux设备驱动开发详解：基于4.0内核》

### chap3、Linux内核及内核编程

#### 3.3、Linux内核的组成

##### 3.3.1、Linux内核源代码的目录结构

##### 3.3.2、Linux内核的组成部分

+ 5个部分（**图3.3**里的各组成部分的关系）
  + VFS
  + MM
  + SCHED
  + NET
  + IPC
+ 5个部分的依赖关系是：

###### 1、进程调度

+ 多个进程对CPU的访问
+ *Linux进程状态转换*
+ `struct task_struct{};`
  + pthread_create()的时候，本质上内核只是创建了一个新的task_struct。

###### 2、内存管理

+ **多个进程安全地共享主存区域**
+ 内核空间和用户空间的具体界限是可以调整的

###### 5、进程间通信

+ 支持进程间的多种通信机制，包括**信号量、共享内存、消息队列、管道、UNIX域套接字**

+ Android内核新增了**Binder进程间通信**

##### 3.3.3、Linux内核空间与用户空间

+ ARM处理器的7种工作模式

#### 3.4、Linux内核的编译及加载

##### 3.4.1、Linux内核的编译

3.5、Linux下的C编程特点

3.6、工具链

3.7、实验室建设

3.8、串口工具

3.9、总结

### chap4、Linux内核模块

+ *lionel，这个地方，自己可以写个sample，还是必须要靠环境*

#### 4.1、Linux内核模块简介

+ **模块**本身不被编译入内核映像，一旦被加载，它就和内核中的其他部分完全一样
+ `modinfo hello.ko`

#### 4.2、Linux内核模块程序结构

#### 4.3、模块加载函数

+ 以`__init`标识声明，加载函数

#### 4.4、模块卸载函数

+ 以`__exit`

4.5、模块参数

4.6、导出符号

4.7、模块声明与描述

4.8、模块的使用计数

4.9、模块的编译

4.10、使用模块“绕开”GPL

4.11、总结

### chap5、Linux文件系统与设备文件

#### 5.1、Linux文件操作

#### 5.2、Linux文件系统

##### 5.2.1、Linux文件系统目录结构

##### 5.2.2、Linux文件系统与设备驱动

+ *lionel，这个命令的执行，我好像在哪看过，但不记得了，应该也是 宋宝华，还是 Linux C一站式里的了*

+ VFS与文件系统以及设备文件之间的接口**是`file_operations`结构体成员函数**
+ fs/block.c中的`def_blk_fops`
+ `dd if=/dev/sdb1 of=sdb1.img`

###### 1、file结构体，`struct file{};`

###### 2、inode结构体，`struct inode{};`

#### 5.3、devfs（2.4引入，2.6抛弃了）

+ **设备文件系统**，2.4引入，有如下优点
  + 1、可通过程序在设备初始化时在/dev目录下创建设备文件，卸载设备时将它删除
  + 2、
  + 3、

#### 5.4、udev用户空间设备管理

##### 5.4.1、udev与devfs的区别

5.4.2、sysfs文件系统与Linux设备模型

5.4.3、udev的组成

5.4.4、udev规则文件

#### 5.5、总结